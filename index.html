<!DOCTYPE html>
<html>
    <head>
        <title>MashUp Test</title>
    </head>
    <body>
        <div>
            <h2>ID:</h2>
            <h3 id="bp_id"></h3>
        </div>
        <div>
            <h2>Email:</h2>
            <h3 id="data_name"></h3>
        </div>

        <script>
            async function fetchData() {
                const pa = new URLSearchParams(window.location.search);
                const userKey = pa.get("userKey");
                const secret = pa.get("secret");
                const apiKey = pa.get("apiKey");
                let bp_id = pa.get("bp_id");
                
                document.getElementById("bp_id").innerHTML = bp_id;

                var newScript = document.createElement("script");
                newScript.src = `https://cdns.gigya.com/js/gigya.js?apikey=${apiKey}`;
                target.appendChild(newScript);

                /*
                let url = `https://accounts.eu2.gigya.com/accounts.getAccountInfo?ApiKey=${apiKey}&userKey=${userKey}&secret=${secret}&UID=${bp_id}`;

                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`Response status: ${response.status}`);
                    }
                    const json = await response.json();
                    console.log(json);

                    document.getElementById("bp_id").innerHTML = json.profile.email;
                } catch (error) {
                    console.error('Error fetching data:', error);
                }
                    */
            }

            fetchData();
            debugger;
        </script>
        <script>
                const pa = new URLSearchParams(window.location.search);
                let bp_id = pa.get("bp_id");

            var params = {
                "UID":"bp_id",
                "include":"identities-active,identities-all,identities-global,loginIDs,emails,profile,data, password,lastLoginLocation, regSource,irank,rba,subscriptions,userInfo",
                "extraProfileFields":"languages,address,phones, education, honors, publications, patents, certifications, professionalHeadline, bio, industry, specialties, work, skills, religion, politicalView, interestedIn, relationshipStatus, hometown, favorites, followersCount, followingCount, username, locale, verified, timezone, likes, samlData"
            }
            gigya.accounts.getAccountInfo(params);
            debugger;
        </script>
    </body>
</html>